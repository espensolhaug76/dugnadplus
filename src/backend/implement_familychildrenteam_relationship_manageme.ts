Sure, here's the SQL and JavaScript code.

SQL Code to create tables:

```sql
CREATE TABLE Family (
  family_id SERIAL PRIMARY KEY,
  family_name TEXT NOT NULL
);

CREATE TABLE Child (
  child_id SERIAL PRIMARY KEY,
  child_name TEXT NOT NULL,
  age INT NOT NULL,
  family_id INT REFERENCES Family(family_id),
  team_id INT REFERENCES Team(team_id)
);

CREATE TABLE Team (
  team_id SERIAL PRIMARY KEY,
  team_name TEXT NOT NULL,
  coach_id INT
);
```

JavaScript/TypeScript functions:

```javascript
const supabase = require('@supabase/supabase-js')

let supabaseUrl = 'https://xyzcompany.supabase.co'
let supabaseKey = 'public-anon-key'
let supabase = supabase.createClient(supabaseUrl, supabaseKey)

async function fetchFamilies() {
  let { data: families, error } = await supabase
    .from('Family')
    .select('*')
  if(error) console.log('Error: ', error);
  else return families;
}

async function fetchFamily(family_id) {
  let { data: family, error } = await supabase
    .from('Family')
    .select('*')
    .eq('family_id', family_id)
  if(error) console.log('Error: ', error);
  else return family;
}

async function createFamily(family_name) {
  const { data: family, error } = await supabase
    .from('Family')
    .insert({ family_name })
  if(error) console.log('Error: ', error);
  else return family;
}

// Similar functions can be created for Child and Team.
```
API endpoint implementations:

```javascript
app.get('/families', async (req, res) => {
  const families = await fetchFamilies();
  res.json(families);
});

app.get('/families/:family_id', async (req, res) => {
  const family = await fetchFamily(req.params.family_id);
  res.json(family);
});

app.post('/families', async (req, res) => {
  const newFamily = await createFamily(req.body.family_name);
  res.json(newFamily);
});

// Similar endpoints can be created for Child and Team.
```

Error handling is done using the `error` object returned by Supabase client. If there's an error, it's logged to the console. You can modify this to handle errors in a way that suits your needs.

For Norwegian business logic, you would need to specify what kind of business rules or logic you want to implement. The code would vary based on specific requirements.